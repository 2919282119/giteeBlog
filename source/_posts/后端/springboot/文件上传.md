---
title: 阿里oss上传文件
tags: 
- springboot
categories: 
---
## 阿里oss上传文件

### 1.引入依赖

```xml
    <dependency>
        <groupId>com.aliyun.oss</groupId>
        <artifactId>aliyun-sdk-oss</artifactId>
        <version>3.15.1</version>
    </dependency>
    <dependency>
        <groupId>javax.xml.bind</groupId>
        <artifactId>jaxb-api</artifactId>
        <version>2.3.1</version>
    </dependency>
    <dependency>
        <groupId>javax.activation</groupId>
        <artifactId>activation</artifactId>
        <version>1.1.1</version>
    </dependency>
    <!-- no more than 2.3.3-->
    <dependency>
        <groupId>org.glassfish.jaxb</groupId>
        <artifactId>jaxb-runtime</artifactId>
        <version>2.3.3</version>
    </dependency>
```
### 2.在Utils包下新建AliOssUtil类
```java
public class AliOssUtil {
    private static final String ENDPOINT = "https://oss-cn-hangzhou.aliyuncs.com";
    private static final String ACCESS_KEY_ID="xxxxxxxxxxxxxx";
    private static final String ACCESS_KEY_SECRET="xxxxxxxxxxxxxx";
    private static final String BUCKETNAME = "xxxxxx";

    public static String uploadFile(String objectName, InputStream inputStream){
        String url="https://"+BUCKETNAME+"."+ENDPOINT.substring(8)+"/"+objectName;
        OSS ossClient = new OSSClientBuilder().build(ENDPOINT, ACCESS_KEY_ID,ACCESS_KEY_SECRET);

        try {
            // 创建PutObjectRequest对象。
            PutObjectRequest putObjectRequest = new PutObjectRequest(BUCKETNAME, objectName, inputStream);

            // 上传文件。
            PutObjectResult result = ossClient.putObject(putObjectRequest);
        } catch (OSSException oe) {
            System.out.println("Error Message:" + oe.getErrorMessage());
        } finally {
            if (ossClient != null) {
                ossClient.shutdown();
            }
        }
        return url;
    }

}

```
### 3.在controller层调用
```java
@RestController
@RequestMapping("/file")
public class FileController {
    @PostMapping("upload")
    public Result uploadFile(MultipartFile file) throws IOException {
        String originalFileName = file.getOriginalFilename();
        String fileName= UUID.randomUUID().toString()+originalFileName.substring(originalFileName.lastIndexOf("."));
        String url = AliOssUtil.uploadFile(fileName, file.getInputStream());
        return Result.success(url);
    }

}

```
### 4.前端调用
```Vue
<script setup>
import { computed, defineComponent, reactive, ref } from 'vue';
import { message } from 'ant-design-vue';
import { UploadOutlined } from '@ant-design/icons-vue';
import {useUserStore} from "@/stores/useUserStore.js";
const userStore = useUserStore();
import axios from 'axios';

const props = defineProps(["width", "accept","multiple"])
const multiple=computed(()=>props.multiple?true:false);
const width = computed(() => props.width ?? "100%");
const accept = computed(() => props.accept ?? "*");
const state = reactive({
    fileList: []
})

const handleChange = info => {
    if (info.file.status !== 'uploading') {
        console.log(info.file, info.fileList);
    }
    if (info.file.status === 'done') {
        message.success(`${info.file.name} file uploaded successfully`);
    } else if (info.file.status === 'error') {
        message.error(`${info.file.name} file upload failed.`);
    }
};

const headers = computed(() => ({ 'Authorization': userStore.state.token }))

</script>

<template>
    <div class="uploader">
        <a-upload v-model:file-list="state.fileList" name="file" :multiple="props.multiple" action="/api/file/upload"
            :headers="headers" @change="handleChange" :accept="accept">
            <a-button>
                <upload-outlined></upload-outlined>
                Click to Upload
            </a-button>
        </a-upload>
    </div>
</template>

<style scoped lang="less">
.uploader {
    width: v-bind(width);
}
</style>

```

### 补充：在vite.config.js中配置代理
```js
server: {
    port: 9339,
    proxy: {
      '/api': {
        target: 'http://host:8080/',
        changeOrigin: true,
        rewrite: path => path.replace(/^\/api/, '')
      }
    }
  },

```
